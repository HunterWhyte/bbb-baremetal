/* Copyright (c) 2023  Hunter Whyte */
#ifndef _MMC_H
#define _MMC_H

int mmc_init(void);
int mmc_read_block(u32_t* buf, u32_t block);

#define MMC0_BASE 0x48060000

#define MMC0_SD_SYSCONFIG (MMC0_BASE + 0x110)
#define MMC0_SD_SYSSTATUS (MMC0_BASE + 0x114)
#define MMC0_SD_CSRE (MMC0_BASE + 0x124)
#define MMC0_SD_SYSTEST (MMC0_BASE + 0x128)
#define MMC0_SD_CON (MMC0_BASE + 0x12C)
#define MMC0_SD_PWCNT (MMC0_BASE + 0x130)
#define MMC0_SD_SDMASA (MMC0_BASE + 0x200)
#define MMC0_SD_BLK (MMC0_BASE + 0x204)
#define MMC0_SD_ARG (MMC0_BASE + 0x208)
#define MMC0_SD_CMD (MMC0_BASE + 0x20C)
#define MMC0_SD_RSP10 (MMC0_BASE + 0x210)
#define MMC0_SD_RSP32 (MMC0_BASE + 0x214)
#define MMC0_SD_RSP54 (MMC0_BASE + 0x218)
#define MMC0_SD_RSP76 (MMC0_BASE + 0x21C)
#define MMC0_SD_DATA (MMC0_BASE + 0x220)
#define MMC0_SD_PSTATE (MMC0_BASE + 0x224)
#define MMC0_SD_HCTL (MMC0_BASE + 0x228)
#define MMC0_SD_SYSCTL (MMC0_BASE + 0x22C)
#define MMC0_SD_STAT (MMC0_BASE + 0x230)
#define MMC0_SD_IE (MMC0_BASE + 0x234)
#define MMC0_SD_ISE (MMC0_BASE + 0x238)
#define MMC0_SD_AC12 (MMC0_BASE + 0x23C)
#define MMC0_SD_CAPA (MMC0_BASE + 0x240)
#define MMC0_SD_CUR_CAPA (MMC0_BASE + 0x248)
#define MMC0_SD_FE (MMC0_BASE + 0x250)
#define MMC0_SD_ADMAES (MMC0_BASE + 0x254)
#define MMC0_SD_ADMASAL (MMC0_BASE + 0x258)
#define MMC0_SD_ADMASAH (MMC0_BASE + 0x25C)
#define MMC0_SD_REV (MMC0_BASE + 0x2FC)

#define MMC_CMD0_GO_IDLE_STATE 0
#define MMC_CMD1_SEND_OP_COND 1
#define MMC_CMD2_ALL_SEND_CID 2
#define MMC_CMD3_SET_RELATIVE_ADDR 3
#define MMC_CMD4_SET_DSR 4
#define MMC_CMD6_SWITCH 6
#define MMC_CMD7_SELECT_CARD 7
#define MMC_CMD8_SEND_EXT_CSD 8
#define MMC_CMD9_SEND_CSD 9
#define MMC_CMD10_SEND_CID 10
#define MMC_CMD12_STOP_TRANSMISSION 12
#define MMC_CMD13_SEND_STATUS 13
#define MMC_CMD16_SET_BLOCKLEN 16
#define MMC_CMD17_READ_SINGLE_BLOCK 17
#define MMC_CMD18_READ_MULTIPLE_BLOCK 18
#define MMC_CMD19_SEND_TUNING_BLOCK 19
#define MMC_CMD21_SEND_TUNING_BLOCK_HS200 21
#define MMC_CMD23_SET_BLOCK_COUNT 23
#define MMC_CMD24_WRITE_SINGLE_BLOCK 24
#define MMC_CMD25_WRITE_MULTIPLE_BLOCK 25
#define MMC_CMD35_ERASE_GROUP_START 35
#define MMC_CMD36_ERASE_GROUP_END 36
#define MMC_CMD38_ERASE 38
#define MMC_CMD55_APP_CMD 55
#define MMC_CMD58_SPI_READ_OCR 58
#define MMC_CMD59_SPI_CRC_ON_OFF 59
#define MMC_CMD62_RES_MAN 62

/* application specific commands */
#define MMC_ACMD6_SET_BUS_WIDTH 6
#define MMC_ACMD13_SD_STATUS 13
#define MMC_ACMD22_SEND_NUM_WR_BLOCKS 22
#define MMC_ACMD23_SET_WR_BLK_ERASE_COUNT 23
#define MMC_ACMD41_SD_SEND_OP_COND 41
#define MMC_ACMD42_SET_CLR_CARD_DETECT 42
#define MMC_ACMD51_SEND_SCR 51
#define MMC_ACMD53_SECURE_RECEIVE 53
#define MMC_ACMD54_SECURE_SEND 54

#define MMC_RSP_NONE 0
#define MMC_RSP_136 1
#define MMC_RSP_48 2
#define MMC_RSP_48_BUSY 3

#endif /*_MMC_H*/
